{% extends 'algosite/base.html' %}
{% load custom_filters %}

{% block title %}Заявки на добавление тем{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width: 900px;">
  <h2 class="text-center mb-4 text-primary">Заявки на добавление тем</h2>

  {% if requests %}
  <ul class="list-group">
    {% for req in requests %}
    <li class="list-group-item mb-4 shadow-sm">
      <h4>{{ req.title }}</h4>

      <section class="mb-4 prose max-w-none">
        <h3>Объяснение</h3>
        <div>{% autoescape off %}{{ explanation_html_dict|get_item:req.id|default:req.explanation }}{% endautoescape %}</div>
      </section>


      <section class="mb-4 prose max-w-none">
        <h3>Пример кода</h3>
        <div>{% autoescape off %}{{ example_code_html_dict|get_item:req.id|default:req.example_code }}{% endautoescape %}</div>
      </section>


      <div class="mb-3">
        <h5>Визуализация упражнения:</h5>
        <div class="border p-3 rounded bg-light" style = "min-height: 900px;">
          {{ req.exercise_render_code|safe }}
        </div>
        <script>{{ req.exercise_logic_code|safe}} </script>
      </div>

      <div class = "mb-3">
        <details style="background: #f9fafb; padding: 1rem; border-radius: 0.5rem; line-height: 1.5; box-shadow: inset 0 0 5px rgba(0,0,0,0.1); margin-bottom: 2rem;">
          <summary style="font-weight: 600; cursor: pointer; font-size: 1.1rem; user-select: none;">Показать HTML код упражнения</summary>
          <pre style="margin-top: 1rem; white-space: pre-wrap; font-family: Consolas, Monaco, monospace; font-size: 0.9rem;">
              {{ req.exercise_render_code }}
          </pre>
        </details>
      </div>

    <div class = "mb-3">
      <details style="background: #f9fafb; padding: 1rem; border-radius: 0.5rem; line-height: 1.5; box-shadow: inset 0 0 5px rgba(0,0,0,0.1); margin-bottom: 2rem;">
          <summary style="font-weight: 600; cursor: pointer; font-size: 1.1rem; user-select: none;">Показать логику проверки</summary>
          <pre style="margin-top: 1rem; white-space: pre-wrap; font-family: Consolas, Monaco, monospace; font-size: 0.9rem;">
              {{ req.exercise_logic_code }}
          </pre>
      </details>
    </div>


      <div class="d-flex gap-3">
        <form method="post" action="{% url 'approve_request' req.id %}" class="m-0">
          {% csrf_token %}
          <button type="submit" class="btn btn-success">Одобрить</button>
        </form>
        <form method="post" action="{% url 'reject_request' req.id %}" class="m-0">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">Отклонить</button>
        </form>
      </div>
    </li>
    {% endfor %}
  </ul>
  {% else %}
      <p class="text-center text-muted">Заявок нет.</p>
  {% endif %}

  <a href="{% url 'index' %}" class="btn btn-primary mt-4 d-block mx-auto" style="max-width: 250px;">← Назад на главную</a>
</div>
{% endblock %}
